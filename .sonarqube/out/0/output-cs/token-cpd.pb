®7
FC:\Users\lucas\source\repos\DatingApp\Controllers\AccountController.cs
	namespace 	
	DatingApp
 
; 
public 
class 
AccountController 
: 
BaseApiController  1
{		 
private

 
readonly

 
IUserRepository

 $
_userRepository

% 4
;

4 5
private 
readonly 
ITokenService "
_tokenService# 0
;0 1
public 

AccountController 
( 
IUserRepository ,
repo- 1
,1 2
ITokenService3 @
tokenServiceA M
)M N
{ 
_userRepository 
= 
repo 
; 
_tokenService 
= 
tokenService $
;$ %
} 
[ 
HttpPost 
( 
$str 
) 
] 
public 

async 
Task 
< 
ActionResult "
<" #
UserDTO# *
>* +
>+ ,
RegisterUser- 9
(9 :
RegisterDTO: E
registerF N
)N O
{ 
if 

(
 
await 

UserExists 
( 
register $
.$ %
Username% -
)- .
). /
{ 	
return 

BadRequest 
( 
$"  
$str  +
{+ ,
register, 4
.4 5
Username5 =
}= >
$str> M
"M N
)N O
;O P
} 	
using 
var 
hmac 
= 
new 

HMACSHA512 '
(' (
)( )
;) *
var 
user 
= 
new 
AppUser 
( 
)  
{ 	
UserName 
= 
register 
.  
Username  (
.( )
ToLower) 0
(0 1
)1 2
,2 3
PasswordHash 
= 
hmac 
.  
ComputeHash  +
(+ ,
Encoding, 4
.4 5
UTF85 9
.9 :
GetBytes: B
(B C
registerC K
.K L
PasswordL T
)T U
)U V
,V W
PasswordSalt   
=   
hmac   
.    
Key    #
}!! 	
;!!	 

_userRepository## 
.## 
Add## 
(## 
user##  
)##  !
;##! "
await$$ 
_userRepository$$ 
.$$ 
SaveAllAsync$$ *
($$* +
)$$+ ,
;$$, -
return&& 
Ok&& 
(&& 
new&& 
UserDTO&& 
(&& 
)&& 
{'' 	
Username(( 
=(( 
register(( 
.((  
Username((  (
,((( )
Token)) 
=)) 
_tokenService)) !
.))! "
CreateToken))" -
())- .
user)). 2
)))2 3
,))3 4
PhotoUrl** 
=** 
user** 
.** 
Photos** "
.**" #
FirstOrDefault**# 1
(**1 2
p**2 3
=>**4 6
p**7 8
.**8 9
IsMain**9 ?
)**? @
?**@ A
.**A B
Url**B E
}++ 	
)++	 

;++
 
},, 
[.. 
HttpPost.. 
(.. 
$str.. 
).. 
].. 
public// 

async// 
Task// 
<// 
ActionResult// "
<//" #
UserDTO//# *
>//* +
>//+ ,
Login//- 2
(//2 3
RegisterDTO//3 >
login//? D
)//D E
{00 
var11 
user11 
=11 
await11 
_userRepository11 (
.11( )
GetUserByName11) 6
(116 7
login117 <
.11< =
Username11= E
)11E F
;11F G
if22 

(22 
user22 
==22 
null22 
)22 
return33 
Unauthorized33 
(33  
)33  !
;33! "
using44 
var44 
hmac44 
=44 
new44 

HMACSHA51244 '
(44' (
user44( ,
.44, -
PasswordSalt44- 9
)449 :
;44: ;
var55 
cpHash55 
=55 
hmac55 
.55 
ComputeHash55 %
(55% &
Encoding55& .
.55. /
UTF855/ 3
.553 4
GetBytes554 <
(55< =
login55= B
.55B C
Password55C K
)55K L
)55L M
;55M N
int66 
i66 
=66 
$num66 
;66 
try77 
{88 	
foreach99 
(99 
var99 
b99 
in99 
cpHash99 $
)99$ %
{:: 
if;; 
(;; 
b;; 
!=;; 
user;; 
.;; 
PasswordHash;; *
[;;* +
i;;+ ,
];;, -
);;- .
return<< 
Unauthorized<< '
(<<' (
)<<( )
;<<) *
i== 
++== 
;== 
}>> 
}?? 	
catch@@ 
(@@ 
System@@ 
.@@ 
	Exception@@ 
)@@  
{AA 	
returnBB 
UnauthorizedBB 
(BB  
)BB  !
;BB! "
}CC 	
returnEE 
OkEE 
(EE 
newEE 
UserDTOEE 
(EE 
)EE 
{FF 	
UsernameGG 
=GG 
loginGG 
.GG 
UsernameGG %
,GG% &
TokenHH 
=HH 
_tokenServiceHH !
.HH! "
CreateTokenHH" -
(HH- .
userHH. 2
)HH2 3
,HH3 4
PhotoUrlII 
=II 
userII 
.II 
PhotosII "
.II" #
FirstOrDefaultII# 1
(II1 2
pII2 3
=>II4 6
pII7 8
.II8 9
IsMainII9 ?
)II? @
?II@ A
.IIA B
UrlIIB E
}JJ 	
)JJ	 

;JJ
 
}KK 
privateMM 
asyncMM 
TaskMM 
<MM 
boolMM 
>MM 

UserExistsMM '
(MM' (
stringMM( .
usernameMM/ 7
)MM7 8
{NN 
returnOO 
awaitOO 
_userRepositoryOO $
.OO$ %
GetUserByNameOO% 2
(OO2 3
usernameOO3 ;
.OO; <
ToLowerOO< C
(OOC D
)OOD E
)OOE F
!=OOG I
nullOOJ N
;OON O
}PP 
}QQ ¢
FC:\Users\lucas\source\repos\DatingApp\Controllers\BaseApiController.cs
	namespace 	
	DatingApp
 
; 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
BaseApiController 
: 
ControllerBase  .
{ 
}

 â
DC:\Users\lucas\source\repos\DatingApp\Controllers\BuggyController.cs
	namespace 	
	DatingApp
 
; 
public 
class 
BuggyController 
: 
BaseApiController 0
{ 
private 
readonly 
DataContext  
_context! )
;) *
public

 

BuggyController

 
(

 
DataContext

 &
context

' .
)

. /
{ 
this 
. 
_context 
= 
context 
;  
} 
[ 
	Authorize 
] 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
string 
> 
	GetSecret  )
() *
)* +
{ 
return 
$str 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
AppUser 
>  
GetNotFound! ,
(, -
)- .
{ 
var 
nUser 
= 
_context 
. 
Users "
." #
Find# '
(' (
-( )
$num) *
)* +
;+ ,
if 

( 
nUser 
== 
null 
) 
return !
NotFound" *
(* +
nUser+ 0
)0 1
;1 2
return 
nUser 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
string 
> 
GetServerError  .
(. /
)/ 0
{ 
var 
nUser 
= 
_context 
. 
Users "
." #
Find# '
(' (
-( )
$num) *
)* +
;+ ,
return   
nUser   
.   
ToString   
(   
)   
;    
}!! 
[## 
HttpGet## 
(## 
$str## 
)## 
]## 
public$$ 

ActionResult$$ 
<$$ 
string$$ 
>$$ 
GetBadRequest$$  -
($$- .
)$$. /
{%% 
return&& 

BadRequest&& 
(&& 
$str&& 7
)&&7 8
;&&8 9
}'' 
})) ºJ
DC:\Users\lucas\source\repos\DatingApp\Controllers\UsersController.cs
	namespace 	
	DatingApp
 
; 
[ 
	Authorize 

]
 
public 
class 
UsersController 
: 
BaseApiController /
{ 
private 
readonly 
IUserRepository $
_userRepository% 4
;4 5
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IPhotoService "
_photoService# 0
;0 1
public 

UsersController 
( 
IUserRepository *
repo+ /
,/ 0
IMapper1 8
mapper9 ?
,? @
IPhotoServiceA N
photoServiceO [
)[ \
{ 
_userRepository 
= 
repo 
; 
_mapper 
= 
mapper 
; 
_photoService 
= 
photoService $
;$ %
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
IEnumerable# .
<. /
	MemberDTO/ 8
>8 9
>9 :
>: ;
GetUsers< D
(D E
)E F
{   
return!! 
Ok!! 
(!! 
await!! 
_userRepository!! '
.!!' (
GetMembersAsync!!( 7
(!!7 8
)!!8 9
)!!9 :
;!!: ;
}"" 
[$$ 
HttpGet$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
ActionResult%% "
<%%" #
AppUser%%# *
>%%* +
>%%+ ,
GetUser%%- 4
(%%4 5
string%%5 ;
username%%< D
)%%D E
{&& 
var'' 
user'' 
='' 
await'' 
_userRepository'' (
.''( )
GetMemberByName'') 8
(''8 9
username''9 A
)''A B
;''B C
if(( 

((( 
user(( 
==(( 
null(( 
)(( 
return)) 
NotFound)) 
()) 
user))  
)))  !
;))! "
return** 
Ok** 
(** 
user** 
)** 
;** 
}++ 
[-- 
HttpPut-- 
]-- 
public.. 

async.. 
Task.. 
<.. 
ActionResult.. "
>.." #

UpdateUser..$ .
(... /
MemberUpdateDTO../ >
memberUpdate..? K
)..K L
{// 
var00 
user00 
=00 
await00 
_userRepository00 (
.00( )
GetUserByName00) 6
(006 7
User007 ;
.00; <
GetUsername00< G
(00G H
)00H I
)00I J
;00J K
if11 

(11 
user11 
==11 
null11 
)11 
{11 
return22 
NotFound22 
(22 
User22  
.22  !
GetUsername22! ,
(22, -
)22- .
)22. /
;22/ 0
}33 	
_mapper44 
.44 
Map44 
(44 
memberUpdate44  
,44  !
user44" &
)44& '
;44' (
if55 

(55 
await55 
_userRepository55 !
.55! "
SaveAllAsync55" .
(55. /
)55/ 0
)550 1
return552 8
	NoContent559 B
(55B C
)55C D
;55D E
return66 

BadRequest66 
(66 
user66 
)66 
;66  
}77 
[99 
HttpPost99 
(99 
$str99 
)99 
]99 
public:: 

async:: 
Task:: 
<:: 
ActionResult:: "
<::" #
PhotoDTO::# +
>::+ ,
>::, -
AddPhoto::. 6
(::6 7
	IFormFile::7 @
file::A E
)::E F
{;; 
var<< 
user<< 
=<< 
await<< 
_userRepository<< (
.<<( )
GetUserByName<<) 6
(<<6 7
User<<7 ;
.<<; <
GetUsername<<< G
(<<G H
)<<H I
)<<I J
;<<J K
if>> 

(>> 
user>> 
==>> 
null>> 
)>> 
{>> 
return>> "
NotFound>># +
(>>+ ,
)>>, -
;>>- .
}>>/ 0
var?? 
res?? 
=?? 
await?? 
_photoService?? %
.??% &
AddPhotoAsync??& 3
(??3 4
file??4 8
)??8 9
;??9 :
if@@ 

(@@ 
res@@ 
.@@ 
Error@@ 
!=@@ 
null@@ 
)@@ 
{@@  
return@@! '

BadRequest@@( 2
(@@2 3
res@@3 6
.@@6 7
Error@@7 <
.@@< =
Message@@= D
)@@D E
;@@E F
}@@G H
varAA 
photoAA 
=AA 
newAA 
PhotoAA 
(AA 
)AA 
{BB 	
UrlCC 
=CC 
resCC 
.CC 
	SecureUrlCC 
.CC  
AbsoluteUriCC  +
,CC+ ,
PublicIdDD 
=DD 
resDD 
.DD 
PublicIdDD #
,DD# $
}EE 	
;EE	 

ifGG 

(GG 
userGG 
.GG 
PhotosGG 
.GG 
CountGG 
==GG  
$numGG! "
)GG" #
{GG$ %
photoGG& +
.GG+ ,
IsMainGG, 2
=GG3 4
trueGG5 9
;GG9 :
}GG; <
userHH 
.HH 
PhotosHH 
.HH 
AddHH 
(HH 
photoHH 
)HH 
;HH 
ifII 

(II 
awaitII 
_userRepositoryII !
.II! "
SaveAllAsyncII" .
(II. /
)II/ 0
)II0 1
{JJ 	
varKK 
dtoKK 
=KK 
_mapperKK 
.KK 
MapKK !
<KK! "
PhotoDTOKK" *
>KK* +
(KK+ ,
photoKK, 1
)KK1 2
;KK2 3
returnLL 
OkLL 
(LL 
dtoLL 
)LL 
;LL 
}MM 	
returnNN 

BadRequestNN 
(NN 
photoNN 
)NN  
;NN  !
}OO 
[QQ 
HttpPutQQ 
(QQ 
$strQQ '
)QQ' (
]QQ( )
publicRR 

asyncRR 
TaskRR 
<RR 
ActionResultRR "
>RR" #
SetMainPhotoRR$ 0
(RR0 1
[RR1 2
	FromRouteRR2 ;
]RR; <
intRR< ?
photoIdRR@ G
)RRG H
{SS 
varTT 
userTT 
=TT 
awaitTT 
_userRepositoryTT (
.TT( )
GetUserByNameTT) 6
(TT6 7
UserTT7 ;
.TT; <
GetUsernameTT< G
(TTG H
)TTH I
)TTI J
;TTJ K
ifUU 

(UU 
userUU 
==UU 
nullUU 
)UU 
{UU 
returnUU "
NotFoundUU# +
(UU+ ,
)UU, -
;UU- .
}UU/ 0
varVV 
photoVV 
=VV 
userVV 
.VV 
PhotosVV 
.VV  
FirstOrDefaultVV  .
(VV. /
pVV/ 0
=>VV1 3
pVV4 5
.VV5 6
IdVV6 8
==VV9 ;
photoIdVV< C
)VVC D
;VVD E
ifWW 

(WW 
photoWW 
==WW 
nullWW 
)WW 
{WW 
returnWW #
NotFoundWW$ ,
(WW, -
)WW- .
;WW. /
}WW0 1
ifXX 

(XX 
photoXX 
.XX 
IsMainXX 
)XX 
{XX 
returnXX "

BadRequestXX# -
(XX- .
$strXX. B
)XXB C
;XXC D
}XXE F
varYY 
mainYY 
=YY 
userYY 
.YY 
PhotosYY 
.YY 
FirstOrDefaultYY -
(YY- .
pYY. /
=>YY0 2
pYY3 4
.YY4 5
IsMainYY5 ;
)YY; <
;YY< =
ifZZ 

(ZZ 
mainZZ 
!=ZZ 
nullZZ 
)ZZ 
{ZZ 
mainZZ  
.ZZ  !
IsMainZZ! '
=ZZ( )
falseZZ* /
;ZZ/ 0
}ZZ1 2
photo[[ 
.[[ 
IsMain[[ 
=[[ 
true[[ 
;[[ 
if\\ 

(\\ 
await\\ 
_userRepository\\ !
.\\! "
SaveAllAsync\\" .
(\\. /
)\\/ 0
)\\0 1
{]] 	
return^^ 
	NoContent^^ 
(^^ 
)^^ 
;^^ 
}__ 	
return`` 

BadRequest`` 
(`` 
photoId`` !
)``! "
;``" #
}aa 
}hh §
9C:\Users\lucas\source\repos\DatingApp\Data\DataContext.cs
	namespace 	
	DatingApp
 
; 
public 
class 
DataContext 
: 
	DbContext $
{ 
public 

DataContext 
( 
DbContextOptions '
options( /
)/ 0
:1 2
base3 7
(7 8
options8 ?
)? @
{		 
}

 
	protected 
override 
void  
ConfigureConventions 0
(0 1%
ModelConfigurationBuilder1 J
builderK R
)R S
{ 
builder 
. 

Properties 
< 
DateOnly #
># $
($ %
)% &
. 
HaveConversion 
< 
DateOnlyConverter -
>- .
(. /
)/ 0
. 
HaveColumnType 
( 
$str "
)" #
;# $
builder 
. 

Properties 
< 
DateOnly #
?# $
>$ %
(% &
)& '
. 
HaveConversion 
< %
NullableDateOnlyConverter 5
>5 6
(6 7
)7 8
. 
HaveColumnType 
( 
$str "
)" #
;# $
} 
public 

DbSet 
< 
AppUser 
> 
Users 
{  !
get" %
;% &
set' *
;* +
}, -
} 
public 
class 
DateOnlyConverter 
:  
ValueConverter! /
</ 0
DateOnly0 8
,8 9
DateTime: B
>B C
{ 
public"" 

DateOnlyConverter"" 
("" 
)"" 
:""  
base""! %
(""% &
d## 
=>## 
d## 
.## 

ToDateTime## 
(## 
TimeOnly## &
.##& '
MinValue##' /
)##/ 0
,##0 1
d$$ 
=>$$ 
DateOnly$$ 
.$$ 
FromDateTime$$ &
($$& '
d$$' (
)$$( )
)$$) *
{%% 
}%% 
}&& 
public++ 
class++ %
NullableDateOnlyConverter++ &
:++' (
ValueConverter++) 7
<++7 8
DateOnly++8 @
?++@ A
,++A B
DateTime++C K
?++K L
>++L M
{,, 
public00 
%
NullableDateOnlyConverter00 $
(00$ %
)00% &
:00' (
base00) -
(00- .
d11 	
=>11
 
d11 
==11 
null11 
?22 
null22 
:33 
new33 
DateTime33 
?33 
(33 
d33 
.33 
Value33 #
.33# $

ToDateTime33$ .
(33. /
TimeOnly33/ 7
.337 8
MinValue338 @
)33@ A
)33A B
,33B C
d44 	
=>44
 
d44 
==44 
null44 
?55 
null55 
:66 
new66 
DateOnly66 
?66 
(66 
DateOnly66 $
.66$ %
FromDateTime66% 1
(661 2
d662 3
.663 4
Value664 9
)669 :
)66: ;
)66; <
{77 
}77 
}88 æ
NC:\Users\lucas\source\repos\DatingApp\Data\Migrations\20230704024227_Inital.cs
	namespace 	
	DatingApp
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
Inital 
:  !
	Migration" +
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
nullableK S
:S T
falseU Z
)Z [
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
; 
}   	
}!! 
}"" è
PC:\Users\lucas\source\repos\DatingApp\Data\Migrations\20230705002437_AuthUser.cs
	namespace 	
	DatingApp
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
AuthUser !
:" #
	Migration$ -
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str &
,& '
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str  
,  !
table 
: 
$str 
, 
type 
: 
$str &
,& '
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name   
:   
$str   $
,  $ %
table!! 
:!! 
$str!! 
)!! 
;!!  
migrationBuilder## 
.## 

DropColumn## '
(##' (
name$$ 
:$$ 
$str$$  
,$$  !
table%% 
:%% 
$str%% 
)%% 
;%%  
}&& 	
}'' 
}(( æ

QC:\Users\lucas\source\repos\DatingApp\Data\Migrations\20230705003025_AuthUser2.cs
	namespace 	
	DatingApp
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
	AuthUser2 "
:# $
	Migration% .
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str  
,  !
table 
: 
$str 
, 
newName 
: 
$str '
)' (
;( )
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str $
,$ %
table 
: 
$str 
, 
newName 
: 
$str #
)# $
;$ %
} 	
} 
} ê[
RC:\Users\lucas\source\repos\DatingApp\Data\Migrations\20230711003841_ExtendUser.cs
	namespace 	
	DatingApp
 
. 
Data 
. 

Migrations #
{ 
public		 

partial		 
class		 

ExtendUser		 #
:		$ %
	Migration		& /
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str %
,% &
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
,  
table 
: 
$str 
, 
type 
: 
$str %
,% &
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
DateTime' /
>/ 0
(0 1
name 
: 
$str 
,  
table 
: 
$str 
, 
type 
: 
$str !
,! "
nullable   
:   
false   
,    
defaultValue!! 
:!! 
new!! !
DateTime!!" *
(!!* +
$num!!+ ,
,!!, -
$num!!. /
,!!/ 0
$num!!1 2
,!!2 3
$num!!4 5
,!!5 6
$num!!7 8
,!!8 9
$num!!: ;
,!!; <
$num!!= >
,!!> ?
DateTimeKind!!@ L
.!!L M
Unspecified!!M X
)!!X Y
)!!Y Z
;!!Z [
migrationBuilder## 
.## 
	AddColumn## &
<##& '
DateTime##' /
>##/ 0
(##0 1
name$$ 
:$$ 
$str$$ #
,$$# $
table%% 
:%% 
$str%% 
,%% 
type&& 
:&& 
$str&& 
,&& 
nullable'' 
:'' 
false'' 
,''  
defaultValue(( 
:(( 
new(( !
DateTime((" *
(((* +
$num((+ ,
,((, -
$num((. /
,((/ 0
$num((1 2
,((2 3
$num((4 5
,((5 6
$num((7 8
,((8 9
$num((: ;
,((; <
$num((= >
,((> ?
DateTimeKind((@ L
.((L M
Unspecified((M X
)((X Y
)((Y Z
;((Z [
migrationBuilder** 
.** 
	AddColumn** &
<**& '
string**' -
>**- .
(**. /
name++ 
:++ 
$str++ !
,++! "
table,, 
:,, 
$str,, 
,,, 
type-- 
:-- 
$str-- %
,--% &
nullable.. 
:.. 
false.. 
,..  
defaultValue// 
:// 
$str//  
)//  !
;//! "
migrationBuilder11 
.11 
	AddColumn11 &
<11& '
string11' -
>11- .
(11. /
name22 
:22 
$str22 $
,22$ %
table33 
:33 
$str33 
,33 
type44 
:44 
$str44 %
,44% &
nullable55 
:55 
false55 
,55  
defaultValue66 
:66 
$str66  
)66  !
;66! "
migrationBuilder88 
.88 
	AddColumn88 &
<88& '
string88' -
>88- .
(88. /
name99 
:99 
$str99 
,99  
table:: 
::: 
$str:: 
,:: 
type;; 
:;; 
$str;; %
,;;% &
nullable<< 
:<< 
false<< 
,<<  
defaultValue== 
:== 
$str==  
)==  !
;==! "
migrationBuilder?? 
.?? 
	AddColumn?? &
<??& '
DateTime??' /
>??/ 0
(??0 1
name@@ 
:@@ 
$str@@ "
,@@" #
tableAA 
:AA 
$strAA 
,AA 
typeBB 
:BB 
$strBB !
,BB! "
nullableCC 
:CC 
falseCC 
,CC  
defaultValueDD 
:DD 
newDD !
DateTimeDD" *
(DD* +
$numDD+ ,
,DD, -
$numDD. /
,DD/ 0
$numDD1 2
,DD2 3
$numDD4 5
,DD5 6
$numDD7 8
,DD8 9
$numDD: ;
,DD; <
$numDD= >
,DD> ?
DateTimeKindDD@ L
.DDL M
UnspecifiedDDM X
)DDX Y
)DDY Z
;DDZ [
migrationBuilderFF 
.FF 
	AddColumnFF &
<FF& '
stringFF' -
>FF- .
(FF. /
nameGG 
:GG 
$strGG "
,GG" #
tableHH 
:HH 
$strHH 
,HH 
typeII 
:II 
$strII %
,II% &
nullableJJ 
:JJ 
falseJJ 
,JJ  
defaultValueKK 
:KK 
$strKK  
)KK  !
;KK! "
migrationBuilderMM 
.MM 
CreateTableMM (
(MM( )
nameNN 
:NN 
$strNN 
,NN 
columnsOO 
:OO 
tableOO 
=>OO !
newOO" %
{PP 
IdQQ 
=QQ 
tableQQ 
.QQ 
ColumnQQ %
<QQ% &
intQQ& )
>QQ) *
(QQ* +
typeQQ+ /
:QQ/ 0
$strQQ1 6
,QQ6 7
nullableQQ8 @
:QQ@ A
falseQQB G
)QQG H
.RR 

AnnotationRR #
(RR# $
$strRR$ 8
,RR8 9
$strRR: @
)RR@ A
,RRA B
UrlSS 
=SS 
tableSS 
.SS  
ColumnSS  &
<SS& '
stringSS' -
>SS- .
(SS. /
typeSS/ 3
:SS3 4
$strSS5 D
,SSD E
nullableSSF N
:SSN O
falseSSP U
)SSU V
,SSV W
IsMainTT 
=TT 
tableTT "
.TT" #
ColumnTT# )
<TT) *
boolTT* .
>TT. /
(TT/ 0
typeTT0 4
:TT4 5
$strTT6 ;
,TT; <
nullableTT= E
:TTE F
falseTTG L
)TTL M
,TTM N
PublicIdUU 
=UU 
tableUU $
.UU$ %
ColumnUU% +
<UU+ ,
stringUU, 2
>UU2 3
(UU3 4
typeUU4 8
:UU8 9
$strUU: I
,UUI J
nullableUUK S
:UUS T
falseUUU Z
)UUZ [
,UU[ \
	AppUserIdVV 
=VV 
tableVV  %
.VV% &
ColumnVV& ,
<VV, -
intVV- 0
>VV0 1
(VV1 2
typeVV2 6
:VV6 7
$strVV8 =
,VV= >
nullableVV? G
:VVG H
falseVVI N
)VVN O
}WW 
,WW 
constraintsXX 
:XX 
tableXX "
=>XX# %
{YY 
tableZZ 
.ZZ 

PrimaryKeyZZ $
(ZZ$ %
$strZZ% 0
,ZZ0 1
xZZ2 3
=>ZZ4 6
xZZ7 8
.ZZ8 9
IdZZ9 ;
)ZZ; <
;ZZ< =
table[[ 
.[[ 

ForeignKey[[ $
([[$ %
name\\ 
:\\ 
$str\\ 9
,\\9 :
column]] 
:]] 
x]]  !
=>]]" $
x]]% &
.]]& '
	AppUserId]]' 0
,]]0 1
principalTable^^ &
:^^& '
$str^^( /
,^^/ 0
principalColumn__ '
:__' (
$str__) -
,__- .
onDelete``  
:``  !
ReferentialAction``" 3
.``3 4
Cascade``4 ;
)``; <
;``< =
}aa 
)aa 
;aa 
migrationBuildercc 
.cc 
CreateIndexcc (
(cc( )
namedd 
:dd 
$strdd +
,dd+ ,
tableee 
:ee 
$stree 
,ee  
columnff 
:ff 
$strff #
)ff# $
;ff$ %
}gg 	
	protectedjj 
overridejj 
voidjj 
Downjj  $
(jj$ %
MigrationBuilderjj% 5
migrationBuilderjj6 F
)jjF G
{kk 	
migrationBuilderll 
.ll 
	DropTablell &
(ll& '
namemm 
:mm 
$strmm 
)mm 
;mm  
migrationBuilderoo 
.oo 

DropColumnoo '
(oo' (
namepp 
:pp 
$strpp 
,pp 
tableqq 
:qq 
$strqq 
)qq 
;qq  
migrationBuilderss 
.ss 

DropColumnss '
(ss' (
namett 
:tt 
$strtt 
,tt  
tableuu 
:uu 
$struu 
)uu 
;uu  
migrationBuilderww 
.ww 

DropColumnww '
(ww' (
namexx 
:xx 
$strxx 
,xx  
tableyy 
:yy 
$stryy 
)yy 
;yy  
migrationBuilder{{ 
.{{ 

DropColumn{{ '
({{' (
name|| 
:|| 
$str|| #
,||# $
table}} 
:}} 
$str}} 
)}} 
;}}  
migrationBuilder 
. 

DropColumn '
(' (
name
 
:
 
$str
 !
,
! "
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
 
.
 

DropColumn
 '
(
' (
name
 
:
 
$str
 $
,
$ %
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
 
.
 

DropColumn
 '
(
' (
name
 
:
 
$str
 
,
  
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
 
.
 

DropColumn
 '
(
' (
name
 
:
 
$str
 "
,
" #
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
 
.
 

DropColumn
 '
(
' (
name
 
:
 
$str
 "
,
" #
table
 
:
 
$str
 
)
 
;
  
}
 	
}
 
} Í)
IC:\Users\lucas\source\repos\DatingApp\Data\Repositories\UserRepository.cs
	namespace 	
	DatingApp
 
. 
Data 
. 
Repositories %
{ 
public		 

class		 
UserRepository		 
:		  !
IUserRepository		" 1
{

 
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserRepository 
( 
DataContext )
context* 1
,1 2
IMapper3 :
mapper; A
)A B
{ 	
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
public 
void 
Add 
( 
AppUser 
user  $
)$ %
{ 	
_context 
. 
Users 
. 
Add 
( 
user #
)# $
;$ %
} 	
public 
async 
Task 
< 
	MemberDTO #
># $
GetMemberByName% 4
(4 5
string5 ;
name< @
)@ A
{ 	
return 
await 
_context !
.! "
Users" '
.' (
Where( -
(- .
u. /
=>0 2
u3 4
.4 5
UserName5 =
==> @
nameA E
)E F
.F G
	ProjectToG P
<P Q
	MemberDTOQ Z
>Z [
([ \
_mapper\ c
.c d!
ConfigurationProviderd y
)y z
.z {!
SingleOrDefaultAsync	{ 
(
 
)
 
;
 
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
	MemberDTO& /
>/ 0
>0 1
GetMembersAsync2 A
(A B
)B C
{ 	
return   
await   
_context   !
.  ! "
Users  " '
.  ' (
	ProjectTo  ( 1
<  1 2
	MemberDTO  2 ;
>  ; <
(  < =
_mapper  = D
.  D E!
ConfigurationProvider  E Z
)  Z [
.  [ \
ToListAsync  \ g
(  g h
)  h i
;  i j
}!! 	
public## 
async## 
Task## 
<## 
AppUser## !
>##! "
GetUserByIdAsync### 3
(##3 4
int##4 7
id##8 :
)##: ;
{$$ 	
return%% 
await%% 
_context%% !
.%%! "
Users%%" '
.&& 
	FindAsync&& 
(&& 
id&& 
)&& 
;&& 
}'' 	
public)) 
async)) 
Task)) 
<)) 
AppUser)) !
>))! "
GetUserByName))# 0
())0 1
string))1 7
name))8 <
)))< =
{** 	
return++ 
await++ 
_context++ !
.++! "
Users++" '
.++' (
Include++( /
(++/ 0
u++0 1
=>++2 4
u++5 6
.++6 7
Photos++7 =
)++= >
.++> ? 
SingleOrDefaultAsync++? S
(++S T
u++T U
=>++V X
u++Y Z
.++Z [
UserName++[ c
==++d f
name++g k
)++k l
;++l m
},, 	
public.. 
async.. 
Task.. 
<.. 
IEnumerable.. %
<..% &
AppUser..& -
>..- .
>... /
GetUsersAsync..0 =
(..= >
)..> ?
{// 	
return00 
await00 
_context00 !
.00! "
Users00" '
.00' (
Include00( /
(00/ 0
u000 1
=>002 4
u005 6
.006 7
Photos007 =
)00= >
.00> ?
ToListAsync00? J
(00J K
)00K L
;00L M
}11 	
public33 
async33 
Task33 
<33 
bool33 
>33 
SaveAllAsync33  ,
(33, -
)33- .
{44 	
try55 
{66 
await77 
_context77 
.77 
SaveChangesAsync77 /
(77/ 0
)770 1
;771 2
return88 
true88 
;88 
}99 
catch:: 
(:: 
	Exception:: 
ex:: 
)::  
{;; 
return<< 
false<< 
;<< 
}== 
}>> 	
public@@ 
void@@ 
Update@@ 
(@@ 
AppUser@@ "
user@@# '
)@@' (
{AA 	
_contextBB 
.BB 
EntryBB 
(BB 
userBB 
)BB  
.BB  !
StateBB! &
=BB' (
EntityStateBB) 4
.BB4 5
ModifiedBB5 =
;BB= >
}CC 	
}DD 
}EE °%
2C:\Users\lucas\source\repos\DatingApp\Data\Seed.cs
	namespace 	
	DatingApp
 
; 
public		 
class		 
Seed		 
{

 
public 

static 
async 
Task 
	SeedUsers &
(& '
DataContext' 2
context3 :
): ;
{ 
if 

( 
await 
context 
. 
Users 
.  
AnyAsync  (
(( )
)) *
)* +
{ 	
return 
; 
} 	
var 
userData 
= 
await 
File !
.! "
ReadAllTextAsync" 2
(2 3
$str3 K
)K L
;L M
var 
options 
= 
new !
JsonSerializerOptions /
(/ 0
)0 1
{ 	'
PropertyNameCaseInsensitive '
=( )
true* .
} 	
;	 

var 
users 
= 
JsonSerializer "
." #
Deserialize# .
<. /
List/ 3
<3 4
AppUser4 ;
>; <
>< =
(= >
userData> F
,F G
optionsH O
)O P
;P Q
foreach 
( 
var 
user 
in 
users "
)" #
{ 	
using 
var 
hmac 
= 
new  

HMACSHA512! +
(+ ,
), -
;- .
user 
. 
UserName 
= 
user  
.  !
UserName! )
.) *
ToLower* 1
(1 2
)2 3
;3 4
user 
. 
PasswordHash 
= 
hmac  $
.$ %
ComputeHash% 0
(0 1
Encoding1 9
.9 :
UTF8: >
.> ?
GetBytes? G
(G H
$strH P
)P Q
)Q R
;R S
user 
. 
PasswordSalt 
= 
hmac  $
.$ %
Key% (
;( )
PropertyInfo 
[ 
] 

properties %
=& '
typeof( .
(. /
AppUser/ 6
)6 7
.7 8
GetProperties8 E
(E F
)F G
;G H
foreach   
(   
PropertyInfo   !
property  " *
in  + -

properties  . 8
)  8 9
{!! 
if"" 
("" 
property"" 
."" 
PropertyType"" (
=="") +
typeof"", 2
(""2 3
string""3 9
)""9 :
&&""; =
property""> F
.""F G
GetValue""G O
(""O P
user""P T
)""T U
==""V X
null""Y ]
)""] ^
property## 
.## 
SetValue## %
(##% &
user##& *
,##* +
string##, 2
.##2 3
Empty##3 8
)##8 9
;##9 :
}$$ 
PropertyInfo%% 
[%% 
]%% 
properties2%% &
=%%' (
typeof%%) /
(%%/ 0
Photo%%0 5
)%%5 6
.%%6 7
GetProperties%%7 D
(%%D E
)%%E F
;%%F G
foreach&& 
(&& 
var&& 
photo&& 
in&& !
user&&" &
.&&& '
Photos&&' -
)&&- .
foreach'' 
('' 
PropertyInfo'' %
property''& .
in''/ 1
properties2''2 =
)''= >
{(( 
if)) 
()) 
property)) 
.))  
PropertyType))  ,
==))- /
typeof))0 6
())6 7
string))7 =
)))= >
&&))? A
property))B J
.))J K
GetValue))K S
())S T
photo))T Y
)))Y Z
==))[ ]
null))^ b
)))b c
property**  
.**  !
SetValue**! )
(**) *
photo*** /
,**/ 0
string**1 7
.**7 8
Empty**8 =
)**= >
;**> ?
}++ 
await,, 
context,, 
.,, 
Users,, 
.,,  
AddAsync,,  (
(,,( )
user,,) -
),,- .
;,,. /
}-- 	
await.. 
context.. 
... 
SaveChangesAsync.. &
(..& '
)..' (
;..( )
}// 
}00 
6C:\Users\lucas\source\repos\DatingApp\DTO\MemberDTO.cs
	namespace 	
	DatingApp
 
. 
DTO 
{ 
public 

class 
	MemberDTO 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
int		 
Age		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public

 
string

 
KnownAs

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 

LastActive "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Introduction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

LookingFor  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
	Interests 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
PhotoUrl 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
List 
< 
PhotoDTO 
> 
Photos $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} ã
<C:\Users\lucas\source\repos\DatingApp\DTO\MemberUpdateDTO.cs
	namespace 	
	DatingApp
 
; 
public 
class 
MemberUpdateDTO 
{ 
public 

string 
Introduction 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

string 

LookingFor 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
	Interests 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
City 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
Country		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
}

 º
5C:\Users\lucas\source\repos\DatingApp\DTO\PhotoDTO.cs
	namespace 	
	DatingApp
 
. 
DTO 
{ 
public 

class 
PhotoDTO 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
bool 
IsMain 
{ 
get  
;  !
set" %
;% &
}' (
} 
}		  
8C:\Users\lucas\source\repos\DatingApp\DTO\RegisterDTO.cs
	namespace 	
	DatingApp
 
; 
public 
class 
RegisterDTO 
{ 
[ 
Required 
] 
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}' (
[		 
Required		 
]		 
[

 
StringLength

 
(

 
$num

 
,

 
MinimumLength

 #
=

$ %
$num

& '
)

' (
]

( )
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} 
4C:\Users\lucas\source\repos\DatingApp\DTO\UserDTO.cs
	namespace 	
	DatingApp
 
; 
public 
class 
UserDTO 
{ 
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}& '
public 

string 
Token 
{ 
get 
; 
set "
;" #
}# $
public 

string 
PhotoUrl 
{ 
get  
;  !
set" %
;% &
}' (
} ÿ
9C:\Users\lucas\source\repos\DatingApp\Entities\AppUser.cs
	namespace 	
	DatingApp
 
; 
public 
class 
AppUser 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

string 
UserName 
{ 
get  
;  !
set" %
;% &
}' (
public 

byte 
[ 
] 
PasswordHash 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

byte 
[ 
] 
PasswordSalt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 

DateOnly		 
DateOfBirth		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 

string

 
KnownAs

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 

DateTime 
Created 
{ 
get !
;! "
set# &
;& '
}( )
=* +
DateTime, 4
.4 5
UtcNow5 ;
;; <
public 

DateTime 

LastActive 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
DateTime/ 7
.7 8
UtcNow8 >
;> ?
public 

string 
Introduction 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

string 

LookingFor 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
	Interests 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
City 
{ 
get 
; 
set !
;! "
}# $
public 

string 
Country 
{ 
get 
;  
set! $
;$ %
}& '
public 

List 
< 
Photo 
> 
Photos 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
new. 1
List2 6
<6 7
Photo7 <
>< =
(= >
)> ?
;? @
} ¹	
7C:\Users\lucas\source\repos\DatingApp\Entities\Photo.cs
	namespace 	
	DatingApp
 
; 
[ 
Table 
( 
$str 
) 
] 
public 
class 
Photo 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public		 

string		 
Url		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 

bool

 
IsMain

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 

string 
PublicId 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 
	AppUserId 
{ 
get 
; 
set  #
;# $
}% &
public 

AppUser 
AppUser 
{ 
get  
;  !
set" %
;% &
}' (
} 	
<C:\Users\lucas\source\repos\DatingApp\Errors\ApiException.cs
	namespace 	
	DatingApp
 
; 
public 
class 
ApiException 
{ 
public 

ApiException 
( 
int 

statusCode &
,& '
string 
message &
,& '
string 
details &
)& '
{ 

StatusCode		 
=		 

statusCode		 
;		  
Message

 
=

 
message

 
;

 
Details 
= 
details 
; 
} 
public 

int 

StatusCode 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Message 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Details 
{ 
get 
;  
set! $
;$ %
}& '
} û
MC:\Users\lucas\source\repos\DatingApp\Extensions\ClaimsPrincipalExtensions.cs
	namespace 	
	DatingApp
 
. 

Extensions 
{ 
public 

static 
class %
ClaimsPrincipalExtensions 1
{ 
public 
static 
string 
GetUsername (
(( )
this) -
ClaimsPrincipal. =
user> B
)B C
{ 	
return		 
user		 
.		 
	FindFirst		 !
(		! "

ClaimTypes		" ,
.		, -
NameIdentifier		- ;
)		; <
?		< =
.		= >
Value		> C
;		C D
}

 	
} 
} æ
FC:\Users\lucas\source\repos\DatingApp\Extensions\DateTimeExtensions.cs
	namespace 	
	DatingApp
 
; 
public 
static 
class 
DateTimeExtensions &
{ 
public 

static 
int 
CalculateAge "
(" #
this# '
DateOnly( 0
date1 5
)5 6
{ 
var 
today 
= 
DateOnly 
. 
FromDateTime )
() *
DateTime* 2
.2 3
Today3 8
)8 9
;9 :
int 
age 
= 
today 
. 
Year 
- 
date #
.# $
Year$ (
;( )
if		 

(		 
today		 
<		 
date		 
.		 
AddYears		 !
(		! "
age		" %
)		% &
)		& '
age		( +
--		+ -
;		- .
return

 
age

 
;

 
} 
} ±
EC:\Users\lucas\source\repos\DatingApp\Extensions\ServicesExtension.cs
	namespace 	
	DatingApp
 
; 
public 
static 
class 
ServicesExtension %
{ 
public 

static 
IServiceCollection $
AddServices% 0
(0 1
this1 5
IServiceCollection6 H
servicesI Q
,Q R
IConfigurationS a
configb h
)h i
{ 
services 
. #
AddControllersWithViews (
(( )
)) *
;* +
services 
. 
AddDbContext 
< 
DataContext )
>) *
(* +
opt+ .
=>/ 1
opt2 5
.5 6
UseSqlServer6 B
(B C
configC I
.I J
GetConnectionStringJ ]
(] ^
$str^ g
)g h
)h i
)i j
;j k
services 
. 
	AddScoped 
< 
ITokenService (
,( )
TokenService* 6
>6 7
(7 8
)8 9
;9 :
services 
. 
	AddScoped 
< 
IUserRepository *
,* +
UserRepository, :
>: ;
(; <
)< =
;= >
services 
. 
AddAutoMapper 
( 
	AppDomain (
.( )
CurrentDomain) 6
.6 7
GetAssemblies7 D
(D E
)E F
)F G
;G H
services 
. 
	Configure 
< 
Account "
>" #
(# $
config$ *
.* +

GetSection+ 5
(5 6
$str6 J
)J K
)K L
;L M
services 
. 
	AddScoped 
< 
IPhotoService (
,( )
PhotoService* 6
>6 7
(7 8
)8 9
;9 :
return 
services 
; 
}   
public"" 

static"" 
IServiceCollection"" $
AddIdentityServices""% 8
(""8 9
this""9 =
IServiceCollection""> P
services""Q Y
,""Y Z
IConfiguration""[ i
config""j p
)""p q
{## 
services$$ 
.$$ 
AddAuthentication$$ "
($$" #
JwtBearerDefaults$$# 4
.$$4 5 
AuthenticationScheme$$5 I
)$$I J
.%% 
AddJwtBearer%% 
(%% 
opt%% 
=>%%  
opt%%! $
.%%$ %%
TokenValidationParameters%%% >
=%%? @
new%%A D%
TokenValidationParameters%%E ^
{&& $
ValidateIssuerSigningKey'' (
='') *
true''+ /
,''/ 0
IssuerSigningKey((  
=((! "
new((# & 
SymmetricSecurityKey((' ;
(((; <
Encoding((< D
.((D E
UTF8((E I
.((I J
GetBytes((J R
(((R S
config((S Y
[((Y Z
$str((Z d
]((d e
)((e f
)((f g
,((g h
ValidateIssuer)) 
=))  
false))! &
,))& '
ValidateAudience**  
=**! "
false**# (
,**( )
}++ 
)++ 
;++ 
return,, 
services,, 
;,, 
}-- 
}.. Ñ
CC:\Users\lucas\source\repos\DatingApp\Helpers\AutoMapperProfiles.cs
	namespace 	
	DatingApp
 
. 
Helpers 
{ 
public 
class 
AutoMapperProfiles  
:  !
Profile" )
{		 
public

 
AutoMapperProfiles

	 
(

 
)

 
{ 
	CreateMap 
< 
AppUser 
, 
	MemberDTO 
>  
(  !
)! "
. 
	ForMember 
( 
u 
=> 
u 
. 
PhotoUrl 
, 
o  !
=>" $
o% &
.& '
MapFrom' .
(. /
s/ 0
=>1 3
s4 5
.5 6
Photos6 <
.< =
FirstOrDefault= K
(K L
pL M
=>N P
pQ R
.R S
IsMainS Y
)Y Z
.Z [
Url[ ^
)^ _
)_ `
. 
	ForMember 
( 
u 
=> 
u 
. 
Age 
, 
o 
=> 
o  !
.! "
MapFrom" )
() *
s* +
=>, .
s/ 0
.0 1
DateOfBirth1 <
.< =
CalculateAge= I
(I J
)J K
)K L
)L M
;M N
	CreateMap 
< 
Photo 
, 
PhotoDTO 
> 
( 
) 
;  
	CreateMap 
< 
MemberUpdateDTO 
, 
AppUser %
>% &
(& '
)' (
;( )
} 
} 
} 
AC:\Users\lucas\source\repos\DatingApp\Interfaces\IPhotoService.cs
	namespace 	
	DatingApp
 
. 

Interfaces 
{ 
public 

	interface 
IPhotoService "
{ 
Task 
< 
ImageUploadResult 
> 
AddPhotoAsync  -
(- .
	IFormFile. 7
file8 <
)< =
;= >
Task 
< 
DeletionResult 
> 
DeletePhotoAsync -
(- .
string. 4
publicId5 =
)= >
;> ?
}		 
}

 Ý
AC:\Users\lucas\source\repos\DatingApp\Interfaces\ITokenService.cs
	namespace 	
	DatingApp
 
; 
public 
	interface 
ITokenService 
{ 
string 

CreateToken 
( 
AppUser 
user #
)# $
;$ %
} ¹
CC:\Users\lucas\source\repos\DatingApp\Interfaces\IUserRepository.cs
	namespace 	
	DatingApp
 
. 

Interfaces 
{ 
public 
	interface 
IUserRepository !
{ 
void 
Update 
( 
AppUser 
user 
) 
; 
void		 
Add		 

(		
 
AppUser		 
user		 
)		 
;		 
Task

 
<

 
bool

 
>

 
SaveAllAsync

 
(

 
)

 
;

 
Task 
< 
IEnumerable 
< 
AppUser 
> 
> 
GetUsersAsync *
(* +
)+ ,
;, -
Task 
< 
AppUser 
> 
GetUserByIdAsync  
(  !
int! $
id% '
)' (
;( )
Task 
< 
AppUser 
> 
GetUserByName 
( 
string $
name% )
)) *
;* +
Task 
< 
IEnumerable 
< 
	MemberDTO "
>" #
># $
GetMembersAsync% 4
(4 5
)5 6
;6 7
Task 
< 
	MemberDTO 
> 
GetMemberByName '
(' (
string( .
name/ 3
)3 4
;4 5
} 
} å
GC:\Users\lucas\source\repos\DatingApp\Middleware\ExceptionMiddleware.cs
	namespace 	
	DatingApp
 
; 
public 
class 
ExceptionMiddleware  
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
private		 
readonly		 
ILogger		 
<		 
ExceptionMiddleware		 0
>		0 1
_logger		2 9
;		9 :
private

 
readonly

 
IHostEnvironment

 %
_env

& *
;

* +
public 

ExceptionMiddleware 
( 
RequestDelegate .
next/ 3
,3 4
ILogger5 <
<< =
ExceptionMiddleware= P
>P Q
loggerR X
,X Y
IHostEnvironmentZ j
envk n
)n o
{ 
this 
. 
_next 
= 
next 
; 
this 
. 
_logger 
= 
logger 
; 
this 
. 
_env 
= 
env 
; 
} 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
context. 5
)5 6
{ 
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
	Exception 
ex 
) 
{ 	
_logger 
. 
LogError 
( 
ex 
,  
ex! #
.# $
Message$ +
)+ ,
;, -
context 
. 
Response 
. 
ContentType (
=) *
$str+ =
;= >
context 
. 
Response 
. 

StatusCode '
=( )
(* +
int+ .
). /
HttpStatusCode/ =
.= >
InternalServerError> Q
;Q R
var 
response 
= 
_env 
.  
IsDevelopment  -
(- .
). /
?0 1
new 
ApiException 
( 
context &
.& '
Response' /
./ 0

StatusCode0 :
,: ;
ex< >
.> ?
Message? F
,F G
exH J
.J K

StackTraceK U
?U V
.V W
ToStringW _
(_ `
)` a
)a b
:   
new   
ApiException   
(   
context   &
.  & '
Response  ' /
.  / 0

StatusCode  0 :
,  : ;
ex  < >
.  > ?
Message  ? F
,  F G
$str  H _
)  _ `
;  ` a
var!! 
options!! 
=!! 
new!! !
JsonSerializerOptions!! 3
{""  
PropertyNamingPolicy## $
=##% &
JsonNamingPolicy##' 7
.##7 8
	CamelCase##8 A
,##A B
}$$ 
;$$ 
var%% 
json%% 
=%% 
JsonSerializer%% %
.%%% &
	Serialize%%& /
(%%/ 0
response%%0 8
,%%8 9
options%%: A
)%%A B
;%%B C
await&& 
context&& 
.&& 
Response&& "
.&&" #

WriteAsync&&# -
(&&- .
json&&. 2
)&&2 3
;&&3 4
}'' 	
}(( 
})) ý
;C:\Users\lucas\source\repos\DatingApp\Pages\Error.cshtml.cs
	namespace 	
	DatingApp
 
. 
Pages 
; 
[ 
ResponseCache 
( 
Duration 
= 
$num 
, 
Location %
=& '!
ResponseCacheLocation( =
.= >
None> B
,B C
NoStoreD K
=L M
trueN R
)R S
]S T
public 
class 

ErrorModel 
: 
	PageModel #
{		 
private

 
readonly

 
ILogger

 
<

 

ErrorModel

 '
>

' (
_logger

) 0
;

0 1
public 


ErrorModel 
( 
ILogger 
< 

ErrorModel (
>( )
logger* 0
)0 1
{ 
_logger 
= 
logger 
; 
} 
public 

string 
? 
	RequestId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

bool 
ShowRequestId 
=>  
!! "
string" (
.( )
IsNullOrEmpty) 6
(6 7
	RequestId7 @
)@ A
;A B
public 

void 
OnGet 
( 
) 
{ 
	RequestId 
= 
Activity 
. 
Current $
?$ %
.% &
Id& (
??) +
HttpContext, 7
.7 8
TraceIdentifier8 G
;G H
} 
} ¾
0C:\Users\lucas\source\repos\DatingApp\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddServices 
( 
builder $
.$ %
Configuration% 2
)2 3
;3 4
builder 
. 
Services 
. 
AddIdentityServices $
($ %
builder% ,
., -
Configuration- :
): ;
;; <
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{		 
options

 
.

 
	AddPolicy

 
(

 
$str

 $
,

$ %
builder 
=> 
{ 
builder 
. 
WithOrigins #
(# $
$str$ =
)= >
. 
AllowAnyMethod &
(& '
)' (
. 
AllowAnyHeader &
(& '
)' (
;( )
} 
) 
; 
} 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
app 
. 
UseMiddleware 
< 
ExceptionMiddleware %
>% &
(& '
)' (
;( )
app 
. 
UseCors 
( 
$str 
) 
; 
if 
( 
! 
app 
. 	
Environment	 
. 
IsDevelopment "
(" #
)# $
)$ %
{ 
app 
. 
UseHsts 
( 
) 
; 
} 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 
UseStaticFiles 
( 
) 
; 
app   
.   

UseRouting   
(   
)   
;   
app"" 
."" 
UseAuthentication"" 
("" 
)"" 
;"" 
app## 
.## 
UseAuthorization## 
(## 
)## 
;## 
app$$ 
.$$ 
MapControllerRoute$$ 
($$ 
name%% 
:%% 	
$str%%
 
,%% 
pattern&& 
:&& 
$str&& 0
)&&0 1
;&&1 2
app(( 
.(( 
MapFallbackToFile(( 
((( 
$str(( "
)((" #
;((# $
using)) 
var)) 	
scope))
 
=)) 
app)) 
.)) 
Services)) 
.)) 
CreateScope)) *
())* +
)))+ ,
;)), -
var** 
services** 
=** 
scope** 
.** 
ServiceProvider** $
;**$ %
try++ 
{,, 
var-- 
context-- 
=-- 
services-- 
.-- 
GetRequiredService-- -
<--- .
DataContext--. 9
>--9 :
(--: ;
)--; <
;--< =
await.. 	
Seed..
 
... 
	SeedUsers.. 
(.. 
context..  
)..  !
;..! "
}// 
catch00 
(00 
System00 
.00 
	Exception00 
)00 
{11 
}33 
app44 
.44 
Run44 
(44 
)44 	
;44	 

>C:\Users\lucas\source\repos\DatingApp\Services\PhotoService.cs
	namespace 	
	DatingApp
 
. 
Services 
{		 
public

 

class

 
PhotoService

 
:

 
IPhotoService

  -
{ 
private 
readonly 

Cloudinary #
_cloudinary$ /
;/ 0
public 
PhotoService 
( 
IOptions $
<$ %
Account% ,
>, -
account. 5
)5 6
{ 	
_cloudinary 
= 
new 

Cloudinary (
(( )
account) 0
.0 1
Value1 6
)6 7
;7 8
} 	
public 
async 
Task 
< 
ImageUploadResult +
>+ ,
AddPhotoAsync- :
(: ;
	IFormFile; D
fileE I
)I J
{ 	
var 
	uploadRes 
= 
new 
ImageUploadResult  1
(1 2
)2 3
;3 4
if 
( 
file 
!= 
null 
&& 
file  $
.$ %
Length% +
>, -
$num. /
)/ 0
{ 
using 
var 
stream  
=! "
file# '
.' (
OpenReadStream( 6
(6 7
)7 8
;8 9
var 
upParams 
= 
new "
ImageUploadParams# 4
(4 5
)5 6
{ 
File 
= 
new 
FileDescription .
(. /
file/ 3
.3 4
FileName4 <
,< =
stream> D
)D E
,E F
Transformation "
=# $
new% (
Transformation) 7
(7 8
)8 9
.9 :
Height: @
(@ A
$numA D
)D E
.E F
WidthF K
(K L
$numL O
)O P
.P Q
CropQ U
(U V
$strV \
)\ ]
.] ^
Gravity^ e
(e f
$strf l
)l m
,m n
Folder 
= 
$str &
} 
; 
	uploadRes 
= 
await !
_cloudinary" -
.- .
UploadAsync. 9
(9 :
upParams: B
)B C
;C D
} 
return 
	uploadRes 
; 
}   	
public"" 
async"" 
Task"" 
<"" 
DeletionResult"" (
>""( )
DeletePhotoAsync""* :
("": ;
string""; A
publicId""B J
)""J K
{## 	
var$$ 
	delParams$$ 
=$$ 
new$$ 
DeletionParams$$  .
($$. /
publicId$$/ 7
)$$7 8
;$$8 9
return%% 
await%% 
_cloudinary%% $
.%%$ %
DestroyAsync%%% 1
(%%1 2
	delParams%%2 ;
)%%; <
;%%< =
}&& 	
}'' 
}(( ¿
>C:\Users\lucas\source\repos\DatingApp\Services\TokenService.cs
	namespace 	
	DatingApp
 
; 
public 
class 
TokenService 
: 
ITokenService )
{		 
private

 
readonly

  
SymmetricSecurityKey

 )
_key

* .
;

. /
public 

TokenService 
( 
IConfiguration &
config' -
)- .
{ 
_key 
= 
new  
SymmetricSecurityKey '
(' (
Encoding( 0
.0 1
UTF81 5
.5 6
GetBytes6 >
(> ?
config? E
[E F
$strF P
]P Q
)Q R
)R S
;S T
} 
public 

string 
CreateToken 
( 
AppUser %
user& *
)* +
{ 
var 
claims 
= 
new 
List 
< 
Claim #
># $
($ %
)% &
{ 	
new 
Claim 
( #
JwtRegisteredClaimNames -
.- .
NameId. 4
,4 5
user6 :
.: ;
UserName; C
)C D
,D E
} 	
;	 

var 
creds 
= 
new 
SigningCredentials *
(* +
_key+ /
,/ 0
SecurityAlgorithms1 C
.C D
HmacSha512SignatureD W
)W X
;X Y
var 
tokenDescriptor 
= 
new !#
SecurityTokenDescriptor" 9
{ 	
Subject 
= 
new 
ClaimsIdentity (
(( )
claims) /
)/ 0
,0 1
Expires 
= 
DateTime 
. 
Now "
." #
AddDays# *
(* +
$num+ ,
), -
,- .
SigningCredentials 
=  
creds! &
} 	
;	 

var!! 
tokenHandler!! 
=!! 
new!! #
JwtSecurityTokenHandler!! 6
(!!6 7
)!!7 8
;!!8 9
var"" 
token"" 
="" 
tokenHandler""  
.""  !
CreateToken""! ,
("", -
tokenDescriptor""- <
)""< =
;""= >
return## 
tokenHandler## 
.## 

WriteToken## &
(##& '
token##' ,
)##, -
;##- .
}$$ 
}%% 